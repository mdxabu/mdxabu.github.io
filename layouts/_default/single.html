{{ define "main" }}
<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title">{{ .Title }}</h1>
                {{ $configDateFormat := .Site.Params.dateFormat | default ":date_medium" }}
                {{ with .Date }}
                {{ $ISO_time := dateFormat "2006-01-02T15:04:05-07:00" . }}
                <div class="post-meta">
                    <time datetime="{{ $ISO_time }}" itemprop="datePublished"> {{ . | time.Format $configDateFormat }} </time>
                    {{ if $.Site.Params.goatcounter }}
                    <span class="post-views" style="margin-left: 1em; display: inline-flex; align-items: center; gap: 0.3em;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle;">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                        <span id="goatcounter-views">Loading...</span>
                    </span>
                    {{ end }}
                </div>
                {{ end }}
                {{ if .Params.tags }}
                <div class="post-tags">
                    {{ range .Params.tags }}
                    <a href="{{ "/tags/" | relLangURL }}{{ . | urlize }}/" class="post-tag">#{{ . }}</a>
                    {{ end }}
                </div>
                {{ end }}
            </header>
            {{ partial "toc.html" .}}
            <div class="page-content">
                {{ .Content }}
            </div>
            {{ partial "comments.html" . }}
        </article>
    </main>
</div>
{{ if .Site.Params.goatcounter }}
<script>
// Fetch view count from GoatCounter
(function() {
    var path = window.location.pathname;
    fetch('https://{{ .Site.Params.goatcounter }}.goatcounter.com/counter/' + encodeURIComponent(path) + '.json')
        .then(function(response) { return response.json(); })
        .then(function(data) {
            var count = data.count || 0;
            var viewsEl = document.getElementById('goatcounter-views');
            if (viewsEl) {
                viewsEl.textContent = count.toLocaleString() + ' views';
            }
        })
        .catch(function(error) {
            console.log('Error fetching view count:', error);
            var viewsEl = document.getElementById('goatcounter-views');
            if (viewsEl) {
                viewsEl.textContent = '';
            }
        });
})();
</script>
{{ end }}
{{ end }}
